<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WildFares Admin V3</title>
    <link rel="icon" type="image/png" href="/static/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f1f5f9; }
    </style>
</head>
<body class="min-h-screen">
    <div id="app">
        {% raw %}
        <!-- Login Screen -->
        <div v-if="!authenticated" class="min-h-screen flex items-center justify-center p-4">
            <div class="w-full max-w-sm bg-slate-800 rounded-2xl border border-slate-700 p-8">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-sky-500 rounded-xl flex items-center justify-center mx-auto mb-4">
                        <i class="ph-bold ph-lock-key text-3xl text-white"></i>
                    </div>
                    <h1 class="text-2xl font-bold">WildFares Admin</h1>
                </div>
                <input v-model="password" type="password" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 mb-4 focus:ring-2 focus:ring-sky-500 outline-none" placeholder="Access Key" @keyup.enter="login">
                <button @click="login" class="w-full bg-sky-600 hover:bg-sky-500 text-white font-bold py-3 rounded-xl transition">
                    Unlock
                </button>
                <p v-if="loginError" class="text-center text-rose-500 text-sm mt-4">{{ loginError }}</p>
            </div>
        </div>

        <!-- Main App -->
        <div v-else class="min-h-screen">
            <!-- Header -->
            <div class="bg-slate-800 border-b border-slate-700 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <img src="/static/logo.png" class="w-10 h-10 rounded-lg">
                        <div>
                            <h1 class="text-xl font-bold">WildFares Admin</h1>
                            <p class="text-xs text-slate-400">Scraper Management v3.0</p>
                        </div>
                    </div>
                    <button @click="logout" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-medium transition">
                        Logout
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="p-6 max-w-7xl mx-auto">

                <!-- Dashboard Stats -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-slate-800 border border-slate-700 rounded-xl p-4">
                        <div class="text-sm text-slate-400 mb-1">Auto Scraper</div>
                        <div class="text-2xl font-bold" :class="settings.schedule_auto_enabled === 'true' ? 'text-green-400' : 'text-slate-500'">
                            {{ settings.schedule_auto_enabled === 'true' ? 'ON' : 'OFF' }}
                        </div>
                    </div>
                    <div class="bg-slate-800 border border-slate-700 rounded-xl p-4">
                        <div class="text-sm text-slate-400 mb-1">Midnight</div>
                        <div class="text-2xl font-bold" :class="settings.schedule_midnight_enabled === 'true' ? 'text-green-400' : 'text-slate-500'">
                            {{ settings.schedule_midnight_enabled === 'true' ? 'ON' : 'OFF' }}
                        </div>
                    </div>
                    <div class="bg-slate-800 border border-slate-700 rounded-xl p-4">
                        <div class="text-sm text-slate-400 mb-1">3-Week</div>
                        <div class="text-2xl font-bold" :class="settings.schedule_3week_enabled === 'true' ? 'text-green-400' : 'text-slate-500'">
                            {{ settings.schedule_3week_enabled === 'true' ? 'ON' : 'OFF' }}
                        </div>
                    </div>
                    <div class="bg-slate-800 border border-slate-700 rounded-xl p-4">
                        <div class="text-sm text-slate-400 mb-1">Route Sync</div>
                        <div class="text-2xl font-bold" :class="settings.schedule_route_sync_enabled === 'true' ? 'text-green-400' : 'text-slate-500'">
                            {{ settings.schedule_route_sync_enabled === 'true' ? 'ON' : 'OFF' }}
                        </div>
                    </div>
                    <div class="bg-slate-800 border border-slate-700 rounded-xl p-4">
                        <div class="text-sm text-slate-400 mb-1">Weather</div>
                        <div class="text-2xl font-bold" :class="settings.schedule_weather_enabled === 'true' ? 'text-green-400' : 'text-slate-500'">
                            {{ settings.schedule_weather_enabled === 'true' ? 'ON' : 'OFF' }}
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="flex gap-2 mb-6 border-b border-slate-700">
                    <button v-for="tab in tabs" :key="tab" @click="activeTab = tab"
                        :class="activeTab === tab ? 'border-sky-500 text-sky-400' : 'border-transparent text-slate-400 hover:text-white'"
                        class="px-4 py-2 border-b-2 font-medium transition">
                        {{ tab }}
                    </button>
                </div>

                <!-- Scrapers Tab -->
                <div v-if="activeTab === 'Scrapers'">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                        <!-- Auto Scraper -->
                        <div class="bg-slate-800 border border-slate-700 rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <i class="ph-bold ph-robot text-2xl text-sky-400"></i>
                                    <h3 class="text-lg font-bold">Auto Scraper</h3>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" v-model="settings.schedule_auto_enabled" true-value="true" false-value="false" class="sr-only peer">
                                    <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-sky-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-sky-600"></div>
                                </label>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-xs text-slate-400 block mb-1">Interval (Minutes)</label>
                                    <input v-model="settings.schedule_auto_interval" type="number" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm">
                                </div>
                                <div>
                                    <label class="text-xs text-slate-400 block mb-1">Stale Cache Threshold (Minutes)</label>
                                    <input v-model="settings.scraper_stale_minutes" type="number" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Midnight Scraper -->
                        <div class="bg-slate-800 border border-slate-700 rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <i class="ph-bold ph-moon text-2xl text-purple-400"></i>
                                    <h3 class="text-lg font-bold">Midnight Scraper</h3>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" v-model="settings.schedule_midnight_enabled" true-value="true" false-value="false" class="sr-only peer">
                                    <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-purple-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 block mb-1">Check Interval (Minutes)</label>
                                <input v-model="settings.schedule_midnight_interval" type="number" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm">
                            </div>
                        </div>

                        <!-- 3-Week Scraper -->
                        <div class="bg-slate-800 border border-slate-700 rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <i class="ph-bold ph-calendar-dots text-2xl text-orange-400"></i>
                                    <h3 class="text-lg font-bold">3-Week Scraper</h3>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" v-model="settings.schedule_3week_enabled" true-value="true" false-value="false" class="sr-only peer">
                                    <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-orange-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-600"></div>
                                </label>
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 block mb-1">Run Time (UTC - HH:MM)</label>
                                <input v-model="settings.schedule_3week_time" type="time" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm">
                            </div>
                        </div>

                        <!-- Route Sync -->
                        <div class="bg-slate-800 border border-slate-700 rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <i class="ph-bold ph-map-pin-line text-2xl text-green-400"></i>
                                    <h3 class="text-lg font-bold">Route Sync</h3>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" v-model="settings.schedule_route_sync_enabled" true-value="true" false-value="false" class="sr-only peer">
                                    <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                </label>
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 block mb-1">Run Time (UTC - HH:MM)</label>
                                <input v-model="settings.schedule_route_sync_time" type="time" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm">
                            </div>
                        </div>

                        <!-- Weather Scraper -->
                        <div class="bg-slate-800 border border-slate-700 rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <i class="ph-bold ph-cloud-sun text-2xl text-yellow-400"></i>
                                    <h3 class="text-lg font-bold">Weather Scraper</h3>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" v-model="settings.schedule_weather_enabled" true-value="true" false-value="false" class="sr-only peer">
                                    <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-yellow-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-600"></div>
                                </label>
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 block mb-1">Run Time (UTC - HH:MM)</label>
                                <input v-model="settings.schedule_weather_time" type="time" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm">
                            </div>
                        </div>

                    </div>

                    <!-- Save Button -->
                    <div class="mt-6 flex justify-end">
                        <button @click="saveSettings" class="px-6 py-3 bg-sky-600 hover:bg-sky-500 rounded-xl font-bold transition">
                            Save All Settings
                        </button>
                    </div>
                </div>

                <!-- System Tab -->
                <div v-if="activeTab === 'System'">
                    <div class="bg-slate-800 border border-slate-700 rounded-xl p-6 max-w-2xl">
                        <h3 class="text-lg font-bold mb-4">System Settings</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-slate-400 block mb-2">Max Concurrent Requests</label>
                                    <input v-model="settings.max_concurrent_requests" type="number" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2">
                                </div>
                                <div>
                                    <label class="text-sm text-slate-400 block mb-2">Scraper Timeout (Seconds)</label>
                                    <input v-model="settings.scraper_timeout" type="number" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2">
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-slate-400 block mb-2">User Agent</label>
                                <input v-model="settings.scraper_user_agent" type="text" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-slate-400 block mb-2">Cache Duration (Minutes)</label>
                                    <input v-model="settings.cache_duration_minutes" type="number" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2">
                                </div>
                                <div>
                                    <label class="relative inline-flex items-center cursor-pointer mt-8">
                                        <input type="checkbox" v-model="settings.proxy_enabled" true-value="true" false-value="false" class="sr-only peer">
                                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-sky-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-sky-600"></div>
                                        <span class="ml-3 text-sm">Enable Proxy</span>
                                    </label>
                                </div>
                            </div>
                            <button @click="saveSettings" class="w-full px-4 py-3 bg-sky-600 hover:bg-sky-500 rounded-xl font-bold transition mt-4">
                                Save System Settings
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        {% endraw %}
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    authenticated: false,
                    password: '',
                    loginError: '',
                    activeTab: 'Scrapers',
                    tabs: ['Scrapers', 'System'],
                    settings: {}
                }
            },
            async mounted() {
                const token = localStorage.getItem('admin_token');
                if (token) {
                    this.authenticated = true;
                    await this.fetchSettings();
                }
            },
            methods: {
                async login() {
                    try {
                        const res = await axios.post('/api/admin/login', { password: this.password });
                        localStorage.setItem('admin_token', res.data.token);
                        this.authenticated = true;
                        this.loginError = '';
                        await this.fetchSettings();
                    } catch (e) {
                        this.loginError = 'Invalid access key';
                    }
                },
                logout() {
                    localStorage.removeItem('admin_token');
                    this.authenticated = false;
                },
                async fetchSettings() {
                    const token = localStorage.getItem('admin_token');
                    const res = await axios.get('/api/admin/settings', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    this.settings = res.data;
                },
                async saveSettings() {
                    const token = localStorage.getItem('admin_token');
                    await axios.post('/api/admin/settings', this.settings, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    alert('Settings saved successfully!');
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
