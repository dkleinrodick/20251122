name: Heartbeat Scheduler

on:
  push:
    branches: [ "master" ]
  schedule:
    # Run every 15 minutes to check scraper schedules
    - cron: '*/15 * * * *'
  workflow_dispatch:
    # Manual trigger available in GitHub Actions UI

jobs:
  heartbeat:
    runs-on: ubuntu-latest
    steps:
      - name: Call Heartbeat Endpoint
        run: |
          echo "Calling https://wildfares.com/api/heartbeat..."
          
          # Use temp file for response body to separate it from status code
          curl -v -X POST "https://wildfares.com/api/heartbeat" \
            -H "Content-Type: application/json" \
            -o response.txt \
            -w "%{http_code}" > status_code.txt
            
          HTTP_CODE=$(cat status_code.txt)
          RESPONSE_BODY=$(cat response.txt)
          
          echo "HTTP Status: $HTTP_CODE"
          echo "Response Body: $RESPONSE_BODY"
          
          if [ "$HTTP_CODE" -ne 200 ]; then
            echo "::error::Heartbeat failed with status $HTTP_CODE"
            exit 1
          fi
          
          echo "Heartbeat successful."
