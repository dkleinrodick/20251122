name: Auto Scraper

on:
  push:
    branches: [ "main" ]
  schedule:
    - cron: '0 */4 * * *'
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Python
        uses: actions/setup-python@v4
        with: { python-version: '3.11' }
      - name: Install
        run: pip install -r scraper_cloud/requirements.txt
      - name: Run
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          DATABASE_URL: postgresql://postgres.vwtxmyboywwncglunrxv:egPI3VHuOf4QHSjv@aws-1-us-east-1.pooler.supabase.com:5432/postgres
        run: python scraper_cloud/main.py
